# Whisper Streaming Pipeline (*Broken)

æœ¬é¡¹ç›®æ˜¯åŸºäº [Faster-Whisper](https://github.com/guillaumekln/faster-whisper) çš„å®æ—¶æµå¼è¯­éŸ³è½¬å½•ä¸åŒå£°ä¼ è¯‘ç®¡é“ï¼Œä¸“ä¸ºæ—¥è¯­å®æ—¶åœºæ™¯ï¼ˆå¦‚æ¼”è®²ã€æ¼”å”±ä¼šã€ä¼šè®®ï¼‰è®¾è®¡ã€‚é€šè¿‡é«˜æ•ˆçš„éŸ³é¢‘ç¼“å†²åŒºç®¡ç†ã€LocalAgreement-2 ç¨³å®šç¡®è®¤ç­–ç•¥å’ŒåŠ¨æ€æç¤ºæ›´æ–°æœºåˆ¶ï¼Œå®ç°äº†ä½å»¶è¿Ÿã€é«˜ç²¾åº¦çš„å®æ—¶è¯­éŸ³è½¬å½•ä¸ç¿»è¯‘ã€‚

## åŠŸèƒ½ç‰¹ç‚¹
- **å®æ—¶éŸ³é¢‘æµå¤„ç†**ï¼šæ¨¡æ‹ŸçœŸå®éŸ³é¢‘è¾“å…¥åœºæ™¯ï¼Œå®æ—¶å¤„ç†éŸ³é¢‘æ•°æ®ã€‚
- **ç¼“å†²åŒºç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†éŸ³é¢‘ç¼“å†²åŒºï¼Œç²¾ç¡®æ§åˆ¶å¤„ç†å»¶è¿Ÿã€‚
- **LocalAgreement-2 ç®—æ³•**ï¼šæé«˜å®æ—¶è½¬å½•æ–‡æœ¬çš„ç¨³å®šæ€§å’Œå‡†ç¡®æ€§ã€‚
- **åŠ¨æ€æç¤ºä¼˜åŒ–**ï¼šé€šè¿‡è‡ªåŠ¨æ›´æ–° prompt æå‡è½¬å½•ä¸ç¿»è¯‘çš„ä¸€è‡´æ€§ã€‚
- **æ ‡ç‚¹è£å‰ªç­–ç•¥**ï¼šåŸºäºæ ‡ç‚¹ç¬¦å·æ™ºèƒ½è£å‰ªç¼“å†²åŒºï¼Œä¼˜åŒ–å®æ—¶å¤„ç†æ•ˆç‡ã€‚

## å¿«é€Ÿå¼€å§‹
---

### âš™ï¸ å®‰è£… PyTorchï¼ˆå¿…éœ€ï¼‰

Faster-Whisper åŸºäº PyTorchï¼Œå› æ­¤è¯·å…ˆæ ¹æ®ä½ çš„è®¾å¤‡ï¼ˆCPU/GPUï¼‰å®‰è£… PyTorchã€‚

æ¨èä½¿ç”¨ CUDA 12.1 çš„ GPU åŠ é€Ÿç‰ˆæœ¬ï¼ˆå¦‚éœ€ CPU å¯ç•¥å» CUDA è¯´æ˜ï¼‰ï¼š

```bash
# GPUï¼ˆCUDA 12.1ï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
```

éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```bash
python -c "import torch; print(torch.cuda.is_available()); print(torch.version.cuda)"
```

è¾“å‡ºåº”ä¸ºï¼š

```bash
True
12.1
```

è‹¥ä¸º `False`ï¼Œè¯´æ˜å½“å‰ PyTorch æœªå¯ç”¨ GPUï¼Œè¯·ç¡®è®¤é©±åŠ¨ã€CUDA Toolkit ç­‰æ˜¯å¦æ­£ç¡®å®‰è£…ã€‚

---

### 1. å®‰è£…ä¾èµ–
å»ºè®®ä½¿ç”¨ Python 3.8+ï¼Œæ¨èä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚

```bash
pip install numpy librosa faster-whisper soundfile asyncio fastapi uvicorn
```
> å¦‚é‡ `librosa` å®‰è£…æŠ¥é”™ï¼Œè¯·ç¡®ä¿ `ffmpeg` å’Œ `libav` ç­‰ä¾èµ–æ­£ç¡®å®‰è£…ã€‚

---

### 2. å¯åŠ¨ FastAPI åç«¯

åç«¯æ¥å£æ–‡ä»¶ä¸º `whisper_api.py`ï¼Œä½ å¯ä»¥ä½¿ç”¨ `uvicorn` å¯åŠ¨æœåŠ¡ï¼š

```bash
uvicorn whisper_api:app --host 0.0.0.0 --port 8000
```

- é»˜è®¤ç›‘å¬åœ¨æœ¬åœ° `localhost:8000`
- æ¨¡å‹ä¼šä¸‹è½½/ç¼“å­˜åˆ°ä½ æŒ‡å®šçš„è·¯å¾„ï¼ˆå¦‚ `D:\workspace\models\whisper`ï¼‰

---

### 3. æ‰“å¼€ Web å‰ç«¯è¿›è¡Œæµ‹è¯•

ä½ å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨æ‰“å¼€å‰ç«¯é¡µé¢ `index.html`ï¼š

```bash
# ç¤ºä¾‹ï¼š
file:///your_project_path/index.html
```

ç‚¹å‡»é¡µé¢ä¸Šçš„ **Start** æŒ‰é’®ï¼Œå³å¯å¼€å§‹ä»éº¦å…‹é£é‡‡é›†éŸ³é¢‘å¹¶æ¨é€è‡³åç«¯ã€‚æ¯éš” 500ms æ¨é€ä¸€æ¬¡éŸ³é¢‘ç‰‡æ®µï¼Œå¹¶é€šè¿‡ WebSocket è·å–è½¬å†™ç»“æœï¼Œå®æ—¶å±•ç¤ºå­—å¹•ï¼š

- ğŸŸ¢ **ç»¿è‰²è¾¹æ¡†**ï¼šæ­£åœ¨æ¨ç†ä¸­
- ğŸ”´ **çº¢è‰²è¾¹æ¡†**ï¼šæœªè¿æ¥æˆ–æ¨ç†å·²åœæ­¢

---

### âœ… æ–‡ä»¶ç»“æ„è¯´æ˜

```text
.
â”œâ”€â”€ whisper_stream.py                # æ¨ç†ä¸»é€»è¾‘ä¸ç¼“å†²ç®¡ç†
â”œâ”€â”€ whisper_api.py                   # FastAPI åç«¯æœåŠ¡
â”œâ”€â”€ index.html                       # å‰ç«¯å®æ—¶å­—å¹•é¡µé¢
â”œâ”€â”€ simulate_audio_stream.py         # ç¦»çº¿æµ‹è¯•æ¨¡æ‹Ÿå™¨ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ data/
â”‚   â””â”€â”€ maigo_center_1182mins.wav    # æµ‹è¯•ç”¨éŸ³é¢‘æ•°æ®ï¼ˆè¿·å­é›†ä¼š2åˆ†é’Ÿç‰‡æ®µï¼‰
â””â”€â”€ README.md

```

---

### è‡ªå®šä¹‰è®¾ç½®
å¯ä»¥åœ¨`simulate_audio_stream.py`ä¸­è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š
- `chunk_duration`ï¼šéŸ³é¢‘å¤„ç†çš„æ—¶é—´ç‰‡é•¿åº¦
- `start_time` / `end_time`ï¼šå¤„ç†éŸ³é¢‘çš„å¼€å§‹ä¸ç»“æŸæ—¶é—´
- `model_size`ï¼šWhisper æ¨¡å‹å¤§å°ï¼Œé»˜è®¤ä¸º`large-v3`

> âš ï¸ å»ºè®®æ˜¾å¼è®¾ç½®`simulate_audio_stream.py`ä¸­ download_pathï¼ˆå¦‚ D:\\workspace\\models\\whisperï¼‰ï¼Œä»¥åŠ é€Ÿæ¨¡å‹åŠ è½½å¹¶é¿å…æ¯æ¬¡è¿è¡Œæ—¶é‡å¤ä¸‹è½½æ¨¡å‹æ–‡ä»¶ã€‚

## å‚è€ƒé¡¹ç›®
- [Whisper Streaming by UFAL](https://github.com/ufal/whisper_streaming)
- [Faster-Whisper](https://github.com/guillaumekln/faster-whisper)

## è®¸å¯è¯
æœ¬é¡¹ç›®éµå¾ª MIT åè®®ã€‚

